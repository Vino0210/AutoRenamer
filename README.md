# AutoRenamer 2.0（自动重命名工具）

AutoRenamer 是一个本地离线的批量重命名工具：根据你选择的“日期来源”，给文件名添加日期前缀（`YYYYMMDD_`），并提供**预览、冲突自动编号、撤销**等能力。

> 典型效果：`20260122_原文件名.ext`  
> 日期来源可选：修改时间(mtime) / 创建时间(ctime) / EXIF拍摄时间（照片）/ 视频元数据（可选）

---

## 目录结构（请保持不变）

将本发布包**整体解压**到任意位置后，保持如下结构：

```
AutoRenamer_2.0/
│  AutoRenamer.exe
│  _internal/                （依赖，必须与 exe 同级）
│  README.md
│  免责声明.txt
│  Windows Defender 误报处理说明.txt

✅ 启动方式：双击 `AutoRenamer.exe`

---

## 主要功能

- **拖拽/点击选择**：拖放文件夹或单个文件到界面（拖拽依赖可选组件，缺失也能用“点击选择”）
- **日期来源**：
  - 修改时间（mtime）
  - 创建时间（ctime）
  - EXIF 拍摄时间（照片）
  - 视频元数据（可选：若系统有 `ffprobe` 或安装 `hachoir`，可读取 mp4/mov 等 creation time）
- **过滤器**：
  - 扩展名筛选（逗号/空格分隔，如 `jpg,png,pdf`）
  - 文件名包含 / 排除关键词
- **冲突自动处理**：目标名已存在时自动追加 `_001/_002/...`
- **仅预览（Dry-run）**：不真正改名，只输出预览日志
- **包含子文件夹**：递归处理
- **取消**：处理中可随时取消
- **撤销上一次**：将上一次批量改名按记录回滚（尽力而为，遇到缺失/冲突会跳过并提示）

---

## 快速上手（建议先用示例）

1. 打开 `AutoRenamer.exe`
2. 选择 `示例文件夹_Example`（或直接拖进去）
3. 勾选/设置：
   - 日期来源（建议先用 mtime）
   - 仅预览（先打开 Dry-run 试跑一次）
4. 观察右侧 **Diff 预览** 与冲突提示
5. 关闭 Dry-run 后再执行真实改名
6. 如需回滚，点击 **撤销上一次**

---

## 注意事项（避免踩坑）

- **先小范围测试**：先用少量文件夹确认规则无误
- **项目引用风险**：重命名会改变路径/文件名，可能导致 PS/PR/工程文件引用丢失
- **文件占用**：被软件占用/同步中的文件可能重命名失败
- **同名冲突**：程序会自动编号，但仍建议你检查预览
- **已有日期前缀会跳过**：若文件名已匹配 `^\d{8}_`（例如 `20260122_`），默认不再重复加前缀

---

## 撤销机制说明（重要）

- 撤销记录存储在用户目录下：`%USERPROFILE%\.file_auto_rename\history.db`（Windows）
- “撤销上一次”会按照记录**反向**恢复文件名：
  - 如果找不到“当前文件”，会跳过
  - 如果“目标恢复名已存在”，会跳过（避免覆盖）

建议：对重要资料，仍然先做备份。

---

## 常见问题（FAQ）

### 1) 双击无反应/闪退？
- 确认 `_internal` 与 `AutoRenamer.exe` 同级
- 把整个文件夹移动到如 `D:\Apps\AutoRenamer_2.0\` 再运行（避免中文/过深路径带来的权限或兼容问题）
- 仍失败：请把报错截图 + 你的操作步骤发给作者

### 2) Windows Defender 报毒/拦截？
请查看同目录：`Windows Defender 误报处理说明.txt`

---

## 反馈格式（越清晰越快修）

- Windows 版本：Windows 10/11（最好写具体版本号）
- 软件版本：AutoRenamer 2.0
- 操作步骤：1/2/3（尽量细）
- 报错截图/文字
- 发生的文件夹路径（例如 `D:\Photos\2026\`）

---

## 版本信息

- 版本：2.0
- 构建：PyInstaller（单文件 exe + `_internal` 依赖目录）
- 更新日期：2026-01-22
